---
description: "CI/CD standards: gates, supply chain, and rollout safety."
alwaysApply: true
globs:
  - "**/*"
---

[CI/CD BASELINE]
- Pipeline stages: lint/format/type-check → unit tests + coverage → integration/smoke (DB/cache/API) → security scans (deps + secrets + static security) → build/package + SBOM/signing.
- Required gates: block on lint/type errors, test failures/flakiness, coverage drops in critical paths, and High/Critical vulnerabilities unless risk-accepted with expiry; fail if secrets scan hits.
- Supply chain: pin dependencies/locks; hermetic builds when possible; avoid `latest`; cache verified deps; publish SBOM as artifact.
- Deployment: prefer canary/blue-green; health/readiness checks mandatory; auto-rollback on triggers (p95 latency +20%/15m, error rate +0.5%/10m, critical security event).
- Environment/secrets: config via env/secret manager; least-privilege CI tokens; redact secrets from logs.

[ARCHITECTURE ENFORCEMENT]
- Required CI checks:
  - Static analysis (ESLint/Deptrac) must pass.
  - Architecture dependency checks must pass (layer dependencies, cross-context imports).
  - Public API module exports must be documented (JSDoc/TSDoc headers present).
  - No cross-context domain/infra imports (must use public API modules).
  - Path aliases must be used (no relative imports beyond 1 level).
- Pre-commit hooks:
  - Run architecture checks before commit (static analysis, dependency validation).
  - Block commits with violations (layer dependencies, cross-context imports, path alias violations).
- PR requirements:
  - Architecture review for public API changes (new exports, breaking changes).
  - Documentation updates for new public APIs (JSDoc/TSDoc headers).
  - Verify no architecture violations introduced (use static analysis tools).

[VERIFICATION]
- Provide local pipeline command (e.g., `npm run lint && npm test`, `go test ./...`, `cargo fmt -- --check && cargo clippy && cargo test`) and reference CI workflow path.
