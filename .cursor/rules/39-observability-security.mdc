---
description: "Observability, SLOs & Security â€” non-functional architecture doctrine."
alwaysApply: true
globs:
  - "src/**"
  - "app/**"
  - "backend/**"
  - "services/**"
---

[OBSERVABILITY]
- Each bounded context must:
  - Expose request metrics (latency, throughput, error rates).
  - Track key domain metrics (e.g., payouts, fraud flags, logins).
  - Emit structured logs with correlation IDs and principal information (no secrets).
  - Integrate with tracing (spans at use case boundaries, tagged with context + operation).
- Use case boundaries:
  - Log start/end with correlation ID + principal.
  - Avoid logging sensitive data (passwords, tokens, full PII).

[SECURITY]
- Use mTLS between contexts and avoid unencrypted internal traffic where feasible.
- Separate **AuthN** and **AuthZ** concerns:
  - AuthN: token issuing, identity verification.
  - AuthZ: policies, roles/permissions, contextual decisions.
- Apply least privilege:
  - DB, queue, and cloud roles scoped per context.
  - No shared superuser credentials across multiple bounded contexts.

[SLOS & ERROR BUDGETS]
- Tier H/M contexts must:
  - Define SLOs for availability and latency.
  - Have explicit error budgets and fallback strategies.
- Architectures for Tier H:
  - Prefer fewer dependencies and simple topologies.
  - Avoid unnecessary external calls on critical paths.

[VERIFICATION]
- For major changes:
  - Confirm metrics/logs/traces for new use cases exist or are extended.
  - Confirm new integrations respect mTLS/AuthN/AuthZ policies.
  - Confirm no new sensitive data is logged.
