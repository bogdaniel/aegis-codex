---
description: "Observability, SLOs & Security — non-functional architecture doctrine."
required: false
category: "topic"
subcategory: "observability-security"
globs:
  - "src/**"
  - "app/**"
  - "backend/**"
  - "services/**"
---

[SOURCE OF TRUTH]
- Editable source: `rules/topics/39-observability-security.mdc`
- Generated/consumed copy: `.cursor/rules/39-observability-security.mdc` (keep references intact)

[INTENT]
- Define observability/security logging guidance for sensitive contexts.

[APPLICABILITY]
- Applies to code emitting logs/metrics/traces in sensitive contexts; must align with security/observability spine unless explicit risk override per `.cursor/rules/3G-risk-overrides.mdc`.

[CROSS-REFERENCES]
- Architecture/DDD: `.cursor/rules/36-architecture.mdc`, `.cursor/rules/44-ddd.mdc` (binding)
- Testing/change-discipline: `.cursor/rules/31-testing.mdc`, `.cursor/rules/23-change-control.mdc` (binding)
- Risk overrides: `.cursor/rules/3G-risk-overrides.mdc` (explicit overrides only)

[OBSERVABILITY]
- Each bounded context must:
  - Expose request metrics (latency, throughput, error rates).
  - Track key domain metrics (e.g., payouts, fraud flags, logins).
  - Emit structured logs with correlation IDs and principal information (no secrets).
  - Integrate with tracing (spans at use case boundaries, tagged with context + operation).
- Use case boundaries:
  - **MANDATORY:** Log start/end with correlation ID + principal (user/tenant/service).
  - **MANDATORY:** Avoid logging sensitive data (passwords, tokens, full PII).
  - **FORBIDDEN:** Logging secrets, credentials, or sensitive PII → **REJECT**, redact or remove.
  - **REJECTION CRITERIA:**
    - Use case without logging → **REJECT**, add logging with correlation ID.
    - Logs containing secrets → **REJECT**, redact secrets.

[SECURITY]
- Use mTLS between contexts and avoid unencrypted internal traffic where feasible.
- Separate **AuthN** and **AuthZ** concerns:
  - AuthN: token issuing, identity verification.
  - AuthZ: policies, roles/permissions, contextual decisions.
- Apply least privilege:
  - DB, queue, and cloud roles scoped per context.
  - No shared superuser credentials across multiple bounded contexts.

[SLOS & ERROR BUDGETS]
- Tier H/M contexts must:
  - Define SLOs for availability and latency.
  - Have explicit error budgets and fallback strategies.
- Architectures for Tier H:
  - Prefer fewer dependencies and simple topologies.
  - Avoid unnecessary external calls on critical paths.

[VERIFICATION]
- For major changes:
  - Confirm metrics/logs/traces for new use cases exist or are extended.
  - Confirm new integrations respect mTLS/AuthN/AuthZ policies.
  - Confirm no new sensitive data is logged.
